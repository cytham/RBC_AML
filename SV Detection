


#Extract fasta from fast5 for AML001_run1 (pass_directory)
for i in *; do h5dump -d /Analyses/Basecall_2D_000/BaseCalled_2D/Fastq $i | head -n 12 |tail -n +11 | perl -pe "s/.+\@/>/g" | perl -pe "s/^\s+//g" >> AML_001_run1_pass.fasta ;done

#Extract fasta from fast5 for AML001_run1 (fail_directory)
for i in *; do h5dump -d /Analyses/Basecall_1D_001/BaseCalled_template/Fastq $i| head -n 12 |tail -n +11 | perl -pe "s/.+\@/>/g" | perl -pe "s/^\s+//g" >> AML_001_run1_fail.fasta; done

#Extract fasta from fast5 for AML001_run2 (from Albacore, python)
for i in *; do h5dump -d /Analyses/Basecall_2D_000/BaseCalled_2D/Fastq $i | head -n 12 |tail -n +11 | perl -pe "s/.+\@/>/g" | perl -pe "s/^\s+//g" >> /home/cy/resources/AML_BM_fresh/minION_AML001/bwa_mapping_hg38/AML_001_run2_0.fasta; done

# Map nanopore reads to hg38 (BWA MEM)
bwa mem -t 50 -x ont2d ../../../../hg38/hg38.fa ../AML_001_run2_0_24_.fasta > AML_001_run2_0_24_bwa.sam

# Filter chimeric reads through SA tag in bam file

# Extract fasta sequence of chimeric reads

# Blast chimeric reads againts hg38 

# Remove Satellite DNA reads and identify plausible SVs reads through python script

# Extract fasta sequence of SV reads

# Map WGS reads to SV reads

# Extract WGS alignments with proper concordance and MAPQ >= 10

samtools -q 10

# Sort bam file according to read name
samtools sort -@ 50 -n AML_001_run2_0_24_SV_WGS_properpair_MQ10.bam -o AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort.bam

# Extract fastq file from bam
samtools fastq -@ 50 -1 AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_1.fastq AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort.bam
samtools fastq -@ 50 -2 AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_2.fastq AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort.bam

# Mapping reads to hg38
bwa mem -t 60 ~/resources/hg38/hg38.fa ./AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_1.fastq ./AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_2.fastq > AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38.sam

# Extract alignmentswith improper concordance and MAPQ >=10, convert to sorted bam
samtools view -F 2050 -q 10 -Sb AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38.sam | samtools sort - -o AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38_improper_MQ10.bam

# Convert Bam to bed
bedtools bamtobed -i AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38_improper_MQ10.bam > AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38_improper_MQ10.bed

# Calling peaks from bed file
macs2 callpeak -t AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38_improper_MQ10.bed -f BED -g hs -n AML_001_run2_0_24_SV_WGS_properpair_MQ10_namesort_hg38_improper_MQ10 -q 0.01 --nomodel
